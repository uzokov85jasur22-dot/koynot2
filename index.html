<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>Ultimate Slaym + Explosion + Chaos v2</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
}
canvas { display: block; }
video { display: none; }
</style>
</head>
<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const video = document.getElementById("video");

canvas.width = innerWidth;
canvas.height = innerHeight;

const COUNT = 1400;
const SLIME_RADIUS = 220;

let handsData = [];
let fistDetected = false;

// ‚ú® Nuqtalar
const particles = [];
for (let i = 0; i < COUNT; i++) {
    particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        angle: Math.random() * Math.PI * 2,
        radius: Math.random() * SLIME_RADIUS,
        vx: 0,
        vy: 0,
        owner: -1
    });
}

// ‚úã Hand tracking
const hands = new Hands({
    locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});

hands.setOptions({
    maxNumHands: 2,
    modelComplexity: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
});

// üëä MUSHT ANIQLASH
function isFist(landmarks) {
    const palm = landmarks[0];
    const tips = [8,12,16,20];
    let closed = 0;
    tips.forEach(i=>{
        const dx = landmarks[i].x - palm.x;
        const dy = landmarks[i].y - palm.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if(dist < 0.1) closed++;
    });
    return closed >= 3;
}

// üî• HAND RESULTS
hands.onResults(r=>{
    handsData = [];
    fistDetected = false;

    r.multiHandLandmarks.forEach(h=>{
        const p = h[9];
        handsData.push({
            x: (1 - p.x) * canvas.width,
            y: p.y * canvas.height
        });
        if(isFist(h)) fistDetected = true;
    });
});

// üé• Kamera
new Camera(video,{
    onFrame: async ()=>{ await hands.send({image:video}); },
    width:640,
    height:480
}).start();

// üåå Animatsiya
function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    particles.forEach((p,i)=>{

        // üí£ MUSHT ‚Üí PORTLASH
        if(fistDetected){
            const angle = Math.random()*Math.PI*2;
            const force = Math.random()*40 + 15; // kuchli portlash
            p.vx += Math.cos(angle)*force;
            p.vy += Math.sin(angle)*force;
        }

        // ‚ùå QO‚ÄòL YO‚ÄòQ ‚Üí full chaos
        if(handsData.length===0 && !fistDetected){
            p.vx += (Math.random()-0.5)*3;
            p.vy += (Math.random()-0.5)*3;
            p.owner = -1;
        }

        // ‚úã 1 QO‚ÄòL
        if(handsData.length===1){
            p.owner=0;
        }

        // ‚úã‚úã 2 QO‚ÄòL
        if(handsData.length===2){
            p.owner=i%2;
        }

        // Slaym movement
        if(handsData[p.owner] && !fistDetected){
            const h = handsData[p.owner];

            p.angle += 0.015 + Math.random()*0.01;
            const tx = h.x + Math.cos(p.angle)*p.radius;
            const ty = h.y + Math.sin(p.angle)*p.radius;

            const dx = tx - p.x;
            const dy = ty - p.y;

            // ü´† SLAYM SPRING
            p.vx += dx*0.035;
            p.vy += dy*0.035;
        }

        // damping
        p.vx *= 0.78;
        p.vy *= 0.78;

        p.x += p.vx;
        p.y += p.vy;

        // ekran o‚Äòrami
        if(p.x<0)p.x=canvas.width;
        if(p.x>canvas.width)p.x=0;
        if(p.y<0)p.y=canvas.height;
        if(p.y>canvas.height)p.y=0;

        ctx.fillStyle="white";
        ctx.fillRect(p.x,p.y,2,2);
    });

    requestAnimationFrame(animate);
}

animate();

addEventListener("resize",()=>{
    canvas.width=innerWidth;
    canvas.height=innerHeight;
});
</script>

</body>
</html>
